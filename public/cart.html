<!DOCTYPE html>
<html lang="ja">
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="css/cart.css" />

        <title>Ondairy</title>

        <!-- update the version number as needed -->
        <script defer src="/__/firebase/9.16.0/firebase-app-compat.js"></script>
        <!-- include only the Firebase features as you need -->
        <script defer src="/__/firebase/9.16.0/firebase-auth-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-database-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-firestore-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-functions-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-messaging-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-storage-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-analytics-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-remote-config-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-performance-compat.js"></script>

        <script type="module" defer>
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-analytics.js";
            import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-storage.js";
            import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyCYo7gqY3tezdXmfVbkypRd2eVZXPudPGc",
                authDomain: "ih12b213-4.firebaseapp.com",
                databaseURL: "https://ih12b213-4-default-rtdb.firebaseio.com",
                projectId: "ih12b213-4",
                storageBucket: "ih12b213-4.appspot.com",
                messagingSenderId: "988142203119",
                appId: "1:988142203119:web:eea1669d6d6401350e2b1a",
                measurementId: "G-C80M7XW650"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const storage = getStorage();
            const auth = getAuth();
            const user = auth.currentUser;

            //ユーザー情報を取得する
            export const useUser = () => {
            const auth = getAuth();
            const user = auth.currentUser;

            if (user !== null) {
                const email = user.email;
                const accessToken = user.accessToken;

                const userInfo = {
                email,
                uid,
                };

                return { user: userInfo };
                console.log(user);
            } else {
                return { user };
            }
            };

            onAuthStateChanged(auth, (user) => {
                    if (user) {
                        let uid = user.uid;
                        let now = new Date();
                        console.log(user);

                      //storageの画像を取得する
                      // Get the download URL
                      getDownloadURL(ref(storage, 'form-uploaded/2NLbbj1v5QSxN31ZDSHOVJrLwU82/Fri Mar 03 2023 15:22:12 GMT+0900 (GMT+09:00)'))
                      .then((url) => {
                          // `url` is the download URL for ''
                          // This can be downloaded directly:
                          const xhr = new XMLHttpRequest();
                          xhr.responseType = 'blob';
                          xhr.onload = (event) => {
                          const blob = xhr.response;
                          };
                          xhr.open('GET', url);
                          xhr.send();

                          list.items[0].getDownloadURL();

                          // Or inserted into an <img> element
                          const img = document.getElementById('img');
                          img.src = url;

                          console.log("画像取得成功");
                      })
                      .catch((error) => {
                          console.log("画像取得失敗");
                      });

 //firestoreのフィールドに追加したい
 //ログインしてない時の処理　一意のデータ作成->cartでそのデータを取得　 = アノニマスログイン　　cartでuidのフォルダ内の画像全て取得 listall
                    } else {
                        var storageRef = firebase.storage().ref('form-uploaded/' + "");
                    }
                });

            // corsの参考
            // https://qiita.com/chima91novice/items/0cd46b5965e087609ef5#:~:text=Web%2FHTML%2FCORS_enabled_image-,%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82CORS%E3%81%A8%E3%81%AF,%E3%81%AE%E3%82%82%E3%81%AE%E3%81%A0%E3%81%A8%E3%81%8B%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%80%82

            //サインアウトする
            document.getElementById("signout").addEventListener("click", () => {
                signOut(auth).then(() => {
                    console.log("successful");
                    location.href = "./login.html"
                }).catch((error) => {
                    console.log(error);
                })
            })

            //サインインしていたらアカウント名を表示する
            onAuthStateChanged(auth, (user) => {
            let h3   = document.querySelector('h3');

            if (user) {
                h3.innerText = `${user.displayName}さんがログインしました`;
                console.log(user);
            } else {
                console.log("Not Login");
            }
            });
        </script>
    </head>





      <body>
        <a href="index.html"><button>トップ画面</button></a>
        <a href="login.html"><button>ログイン</button></a>
        <a href="editor.html"><button>編集画面</button></a>                               
        <button class="p-4 bg-stone-300 rounded" id="signout">サインアウト</button>
        <main>
          <div class="basket">
            <div class="basket-labels">
              <ul>
                <li class="item item-heading">商品</li>
                <li class="price">値段</li>
                <li class="quantity">数量</li>
                <li class="subtotal">合計(税込)</li>
              </ul>
            </div>
            <div class="basket-product">
              <div class="item">
                <div class="product-image">
                  <img id="img" src="./css/images/4.webp" alt="Placholder Image 2" class="product-frame">
                </div>
                <div class="product-details">
                  <h1><strong><span class="item-quantity"></span></strong> </h1>
                  <p><strong>Caramel | Black</strong></p>
                </div>
              </div>
              <div class="price">¥400</div>
              <div class="quantity">
                <input type="number" value="4" min="1" class="quantity-field">
              </div>
              <div class="subtotal">¥400</div>
              <div class="remove">
                <button>消去</button>
              </div>
            </div>
            <div class="basket-product">
              <div class="item">
                <div class="product-image">
                  <img src="./css/images/pleats.webp" alt="Placholder Image 2" class="product-frame">
                </div>
                <div class="product-details">
                  <h1><strong><span class="item-quantity"></span> </strong> </h1>
                  <p><strong>Lavender | Black</strong></p>
                </div>
              </div>
              <div class="price">¥400</div>
              <div class="quantity">
                <input type="number" value="1" min="1" class="quantity-field">
              </div>
              <div class="subtotal">¥400</div>
              <div class="remove">
                <button>消去</button>
              </div>
            </div>
          </div>


          <button type="submit" class="btn"><a href="editor.html">デザインを直す</a></button>


          </div>

        </main>




        <!-- テンプレート表示エリア -->
        <div id="container"></div>

        <script>
            // template要素を取得
            var template = document.getElementById('template');

            // template要素の内容を複製
            var clone = template.content.cloneNode(true);

            // div#vcontainerの中に追加
            document.getElementById('container').appendChild(clone);
        </script>

        <footer></footer>
    </body>
</html>