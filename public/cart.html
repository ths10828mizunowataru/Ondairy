<!DOCTYPE html>
<html lang="ja">
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="css/cart.css" />
        <title>Ondairy</title>

        <!-- update the version number as needed -->
        <script defer src="/__/firebase/9.16.0/firebase-app-compat.js"></script>
        <!-- include only the Firebase features as you need -->
        <script defer src="/__/firebase/9.16.0/firebase-auth-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-database-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-firestore-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-functions-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-messaging-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-storage-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-analytics-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-remote-config-compat.js"></script>
        <script defer src="/__/firebase/9.16.0/firebase-performance-compat.js"></script>

        <script type="module" defer>
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-analytics.js";
            import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-storage.js";
            import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyCYo7gqY3tezdXmfVbkypRd2eVZXPudPGc",
                authDomain: "ih12b213-4.firebaseapp.com",
                databaseURL: "https://ih12b213-4-default-rtdb.firebaseio.com",
                projectId: "ih12b213-4",
                storageBucket: "ih12b213-4.appspot.com",
                messagingSenderId: "988142203119",
                appId: "1:988142203119:web:eea1669d6d6401350e2b1a",
                measurementId: "G-C80M7XW650"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const storage = getStorage();
            const auth = getAuth();
            const user = auth.currentUser;

            //ユーザー情報を取得する
            export const useUser = () => {
            const auth = getAuth();
            const user = auth.currentUser;

            if (user !== null) {
                const email = user.email;
                const accessToken = user.accessToken;

                const userInfo = {
                email,
                uid,
                };

                return { user: userInfo };
                console.log(user);
            } else {
                return { user };
            }
            };

            //storageの画像を取得する
            // Get the download URL
            getDownloadURL(ref(storage, 'form-uploaded/ユーザーidとタイムスタンプ'))
            .then((url) => {
                // `url` is the download URL for 'form-uploaded/スクリーンショット (0000).png'

                // This can be downloaded directly:
                const xhr = new XMLHttpRequest();
                xhr.responseType = 'blob';
                xhr.onload = (event) => {
                const blob = xhr.response;
                };
                xhr.open('GET', url);
                xhr.send();

                // Or inserted into an <img> element
                const img = document.getElementById('img');
                img.setAttribute('src', url);

                console.log("画像取得成功");
            })
            .catch((error) => {

                console.log("画像取得失敗");

                // A full list of error codes is available at
                // https://firebase.google.com/docs/storage/web/handle-errors
                switch (error.code) {
                case 'storage/object-not-found':
                    // File doesn't exist
                    break;
                case 'storage/unauthorized':
                    // User doesn't have permission to access the object
                    break;
                case 'storage/canceled':
                    // User canceled the upload
                    break;

                // ...

                case 'storage/unknown':
                    // Unknown error occurred, inspect the server response
                    break;
                }
            });

            // corsの参考
            // https://qiita.com/chima91novice/items/0cd46b5965e087609ef5#:~:text=Web%2FHTML%2FCORS_enabled_image-,%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82CORS%E3%81%A8%E3%81%AF,%E3%81%AE%E3%82%82%E3%81%AE%E3%81%A0%E3%81%A8%E3%81%8B%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%80%82

            //サインアウトする
            document.getElementById("signout").addEventListener("click", () => {
                signOut(auth).then(() => {
                    console.log("successful");
                    location.href = "./login.html"
                }).catch((error) => {
                    console.log(error);
                })
            })

            //サインインしていたらアカウント名を表示する
            onAuthStateChanged(auth, (user) => {
            let h3   = document.querySelector('h3');

            if (user) {
                h3.innerText = `${user.displayName}さんがログインしました`;
                console.log(user);
            } else {
                console.log("Not Login");
            }
            });
        </script>
    </head>
    <body>
        <header></header>
        <a href="index.html"><button>トップ画面</button></a>
        <a href="login.html"><button>ログイン</button></a>
        <a href="editor.html"><button>編集画面</button></a>
        <a href="cart.html"><button>カート画面</button></a>
        <button class="p-4 bg-stone-300 rounded" id="signout">サインアウト</button>

        <h3>CART</h3>

        <p class="1">
            お支払い・お届け先の指定・お届け日の指定 > ご注文内容の確認 > ご注文完了
        </p>

        <p class="2">
            ※セール商品の返品・交換・キャンセルはできません。予めご了承下さい。
        </p>



        <div class="">

        </div>

        <!-- テンプレートとして表示したい内容 -->
        <template id="template">
            <img id="img" src="" alt="">
            <h1></h1>
        </template>

        <!-- テンプレート表示エリア -->
        <div id="container"></div>

        <script>
            // template要素を取得
            var template = document.getElementById('template');

            // template要素の内容を複製
            var clone = template.content.cloneNode(true);

            // div#vcontainerの中に追加
            document.getElementById('container').appendChild(clone);
        </script>

        <footer></footer>
    </body>
</html>